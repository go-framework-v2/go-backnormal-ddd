# 如何区分领域：按限界上下文划分

## 一、核心思路

领域划分依据是业务概念和职责，而不是接口或功能列表：

* 每个领域有自己的核心概念和业务规则
* 不同领域之间的语言和模型是独立的
* 通过 ID 或明确接口 互相引用，不直接依赖实现

---

## 二、user\_center\_go 的限界上下文划分

结合你现有的功能，可以这样拆：


| 限界上下文            | 核心职责                 | 主要概念                      | 对应能力                |
| --------------------- | ------------------------ | ----------------------------- | ----------------------- |
| identity（身份/认证） | 用户是谁、怎么登录、会话 | User, App, AuthType, DeviceID | 游客/手机/阿里/微信登录 |
| membership（会员）    | 会员选项、配置、商品     | VipConfig, VipOption          | 购买会员选项列表        |
| payment（支付）       | 下单、支付、回调、退款   | Order, Payment                | 支付相关接口            |

---

## 三、领域层目录结构（按上下文）

**internal/**

**├── domain/**

**│   ├── identity/              # 身份/认证上下文**

**│   │   ├── auth\_type.go**

**│   │   ├── user\_id.go**

**│   │   ├── app\_id.go**

**│   │   ├── app.go**

**│   │   ├── user.go**

**│   │   ├── user\_repository.go**

**│   │   └── app\_repository.go**

**│   │**

**│   ├── membership/            # 会员上下文**

**│   │   ├── vip\_config.go      # 会员选项/商品**

**│   │   ├── vip\_config\_id.go**

**│   │   ├── vip\_config\_repository.go**

**│   │   └── (用户会员状态相关，如果有)**

**│   │**

**│   └── payment/               # 支付上下文（后续扩展）**

**│       ├── order.go**

**│       ├── payment.go**

**│       └── ...**

**│**

**├── application/**

**│   ├── dto/**

**│   │   ├── login\_dto.go**

**│   │   ├── vip\_dto.go**

**│   │   └── payment\_dto.go**

**│   └── service/**

**│       ├── login\_service.go      # 编排 identity 领域**

**│       ├── vip\_service.go        # 编排 membership **领域

**│       └── payment\_service.go    # 编排 payment 领域**

**│**

**└── infrastructure/**

**    └── persistence/mysql/**

**        ├── model/**

**        │   ├── uc\_app\_po.go**

**        │   ├── uc\_user\_po.go**

**        │   ├── uc\_vip\_config\_po.go**

**        │   └── ...**

**        └── repository/**

**            ├── app\_repository\_impl.go**

**            ├── user\_repository\_impl.go**

**            ├── vip\_config\_repository\_impl.go**

**            └── ...**

---

## 四、为什么这样划分？

### 1. identity（身份）

* 核心问题：用户是谁、用什么方式登录
* 业务规则：同一 (app\_id, auth\_type, device\_id) 对应一个用户；登录方式不同、用户记录不同
* 和会员、支付的区别：不管买不买会员、付不付款，登录逻辑不变

### 2. membership（会员）

* 核心问题：有哪些会员选项、怎么配置
* 业务规则：每个 App 有一套会员选项；有价格、标题、原价、限时价等
* 和身份的区别：不关心用户如何登录，只关心「这个 App 提供哪些会员商品」

### 3. payment（支付）

* 核心问题：如何下单、支付、处理回调
* 业务规则：订单状态流转、支付方式、退款等
* 和会员的关系：会用到会员配置（商品/价格），但通过 ID 或领域事件关联，不直接耦合

---

## 五、跨上下文怎么协作？

通过 ID 或 领域事件 协作，避免直接依赖对方内部实现：

**┌─────────────────┐         ┌─────────────────┐    **     ┌─────────────────┐

**│   identity      │         │   membership    │    **     │   payment       │

**│                 │         │                 │    **     │                 │

**│  User(user\_id)  │ ──ID──> │ VipConfig(id)   │ **<──ID── │ Order(vip\_id)   │

**│  App(app\_id)    │         │                 │    **     │ Payment         │

**└─────────────────┘         └─────────────────┘    **     └─────────────────┘

**         │                            │            **                │

**         **└────────────────────────────┴────────────────────────────┘

**                              application 层编排**

例如：

* membership 只负责 VipConfig 的查询和规则，不关心 User
* payment 用 vip\_config\_id、user\_id 等 ID 关联，不直接引用 VipConfig / User 结构
* application 层负责：查 User → 查 VipConfig → 创建 Order → 调用支付

---

## 六、当前你关心的几个接口如何归属？


| 接口             | 所属上下文 | 说明               |
| ---------------- | ---------- | ------------------ |
| 游客登录         | identity   | 用户身份与设备绑定 |
| 手机验证码登录   | identity   | 登录方式的一种     |
| 阿里一键登录     | identity   | 同上               |
| 微信登录         | identity   | 同上               |
| 购买会员选项列表 | membership | 会员配置/商品展示  |
| 支付相关         | payment    | 订单与支付流程     |

---

## 七、后续新增功能时怎么判断？

可以问自己几个问题：

1. 这个概念更偏向谁？ 是用户身份、会员商品、还是支付交易？
2. 业务规则主要围绕什么？ 登录规则、会员规则、还是支付规则？
3. 和现有模型是同一语言吗？ 如果用的术语和规则差异很大，多半是新上下文。

---

总结：* 领域 = 限界上下文，按「业务概念 + 职责」划分

* 登录相关 → identity
* 会员配置/选项 → membership
* 支付 → payment

先按这个结构把 identity 和 membership 建起来，支付可以等接口细节确定后再补。如果你愿意，下一步可以专门细化 membership 领域（VipConfig 的模型和仓储）。
